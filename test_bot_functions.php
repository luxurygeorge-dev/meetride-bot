<?php
/**
 * Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ MeetRide Bot
 */

require_once '/var/www/html/meetRiedeBot/botManager.php';

echo "ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ MeetRide Bot\n";
echo "=====================================\n\n";

// Ð¢ÐµÑÑ‚ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚
echo "1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½ÑÑ‚Ð°Ð½Ñ‚:\n";
echo "   DRIVERS_GROUP_CHAT_ID: " . botManager::DRIVERS_GROUP_CHAT_ID . "\n";
echo "   DRIVER_ACCEPTED_STAGE_ID: " . botManager::DRIVER_ACCEPTED_STAGE_ID . "\n";
echo "   PASSENGERS_FIELD: " . botManager::PASSENGERS_FIELD . "\n";
echo "   HIDDEN_FIELD: " . botManager::HIDDEN_FIELD . "\n\n";

// Ð¢ÐµÑÑ‚ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ Ð½Ð¾Ð¼ÐµÑ€Ð° Ð·Ð°ÐºÐ°Ð·Ð°
echo "2. Ð¢ÐµÑÑ‚ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸ Ð½Ð¾Ð¼ÐµÑ€Ð° Ð·Ð°ÐºÐ°Ð·Ð°:\n";
$testTitles = [
    'Ð—Ð°ÑÐ²ÐºÐ°: 123',
    'Ð—Ð°ÑÐ²ÐºÐ°: 999999',
    '123',
    '999999',
    'Ð—Ð°ÑÐ²ÐºÐ°: Ð¢ÐµÑÑ‚ 456'
];

foreach ($testTitles as $title) {
    $orderNumber = $title;
    if (strpos($orderNumber, 'Ð—Ð°ÑÐ²ÐºÐ°: ') === 0) {
        $orderNumber = substr($orderNumber, 8);
    }
    echo "   '$title' -> '$orderNumber'\n";
}
echo "\n";

// Ð¢ÐµÑÑ‚ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
echo "3. Ð¢ÐµÑÑ‚ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹:\n";
$testDeal = [
    'ID' => '123',
    'TITLE' => 'Ð—Ð°ÑÐ²ÐºÐ°: 999999',
    'STAGE_ID' => 'PREPARATION',
    'UF_CRM_1751269222959' => '2025-01-15 14:30:00', // Ð”Ð°Ñ‚Ð°
    'UF_CRM_1751269222958' => 'ÐÑÑ€Ð¾Ð¿Ð¾Ñ€Ñ‚', // ÐžÑ‚ÐºÑƒÐ´Ð°
    'UF_CRM_1751269222957' => 'Ð¦ÐµÐ½Ñ‚Ñ€ Ð³Ð¾Ñ€Ð¾Ð´Ð°', // ÐšÑƒÐ´Ð°
    'UF_CRM_1751269222960' => '5000|RUB', // Ð¡ÑƒÐ¼Ð¼Ð°
    'UF_CRM_1751269222961' => 'Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ', // Ð”Ð¾Ð¿ ÑƒÑÐ»Ð¾Ð²Ð¸Ñ
    'UF_CRM_1751271798896' => 'Ð˜Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð² (79001234567), ÐœÐ°Ñ€Ð¸Ñ Ð¡Ð¸Ð´Ð¾Ñ€Ð¾Ð²Ð° (79007654321)', // ÐŸÐ°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹
    'UF_CRM_1751271841129' => 'Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ' // Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ
];

echo "   Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ ÑÐ´ÐµÐ»ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð°\n";
echo "   TITLE: " . $testDeal['TITLE'] . "\n";
echo "   ÐŸÐ°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹: " . $testDeal['UF_CRM_1751271798896'] . "\n";
echo "   Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ: " . $testDeal['UF_CRM_1751271841129'] . "\n\n";

// Ð¢ÐµÑÑ‚ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
echo "4. Ð¢ÐµÑÑ‚ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ:\n";
try {
    $groupText = botManager::orderTextForGroup($testDeal, 'Ð¢ÐµÑÑ‚ Ð’Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒ');
    echo "   orderTextForGroup() - Ð£Ð¡ÐŸÐ•Ð¨ÐÐž\n";
    echo "   Ð”Ð»Ð¸Ð½Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: " . strlen($groupText) . " ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²\n";
    
    $driverText = botManager::orderTextForDriver($testDeal);
    echo "   orderTextForDriver() - Ð£Ð¡ÐŸÐ•Ð¨ÐÐž\n";
    echo "   Ð”Ð»Ð¸Ð½Ð° ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ: " . strlen($driverText) . " ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²\n";
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ Ð½ÐµÑ‚ Ð¿Ð°ÑÑÐ°Ð¶Ð¸Ñ€Ð¾Ð²
    if (strpos($groupText, 'ÐŸÐ°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹') === false) {
        echo "   âœ… Ð’ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ ÐÐ•Ð¢ Ð¿Ð°ÑÑÐ°Ð¶Ð¸Ñ€Ð¾Ð²\n";
    } else {
        echo "   âŒ Ð’ Ð³Ñ€ÑƒÐ¿Ð¿Ð¾Ð²Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ Ð•Ð¡Ð¢Ð¬ Ð¿Ð°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹!\n";
    }
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ Ð² Ð»Ð¸Ñ‡Ð½Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ ÐµÑÑ‚ÑŒ Ð¿Ð°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹
    if (strpos($driverText, 'ÐŸÐ°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹') !== false) {
        echo "   âœ… Ð’ Ð»Ð¸Ñ‡Ð½Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ Ð•Ð¡Ð¢Ð¬ Ð¿Ð°ÑÑÐ°Ð¶Ð¸Ñ€Ñ‹\n";
    } else {
        echo "   âŒ Ð’ Ð»Ð¸Ñ‡Ð½Ð¾Ð¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¸ ÐÐ•Ð¢ Ð¿Ð°ÑÑÐ°Ð¶Ð¸Ñ€Ð¾Ð²!\n";
    }
    
    // ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, Ñ‡Ñ‚Ð¾ ÑÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð½Ð¸Ð³Ð´Ðµ Ð½Ðµ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ
    if (strpos($groupText, 'Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ') === false && strpos($driverText, 'Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ') === false) {
        echo "   âœ… Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð½Ð¸Ð³Ð´Ðµ Ð½Ðµ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ\n";
    } else {
        echo "   âŒ Ð¡ÐºÑ€Ñ‹Ñ‚Ð¾Ðµ Ð¿Ð¾Ð»Ðµ Ð³Ð´Ðµ-Ñ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ÑÑ!\n";
    }
    
} catch (Exception $e) {
    echo "   âŒ ÐžÑˆÐ¸Ð±ÐºÐ°: " . $e->getMessage() . "\n";
}
echo "\n";

// Ð¢ÐµÑÑ‚ 5: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
echo "5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸:\n";
if (botManager::DRIVERS_GROUP_CHAT_ID == -4704206955) {
    echo "   âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð¢Ð•Ð¡Ð¢ÐžÐ’ÐÐ¯ Ð³Ñ€ÑƒÐ¿Ð¿Ð° (-4704206955)\n";
} else {
    echo "   âŒ ÐžÐ¨Ð˜Ð‘ÐšÐ! Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð³Ñ€ÑƒÐ¿Ð¿Ð°: " . botManager::DRIVERS_GROUP_CHAT_ID . "\n";
}

if (botManager::DRIVERS_GROUP_CHAT_ID != -1002544521661) {
    echo "   âœ… Ð‘ÐžÐ•Ð’ÐÐ¯ Ð³Ñ€ÑƒÐ¿Ð¿Ð° (-1002544521661) ÐÐ• Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ\n";
} else {
    echo "   âŒ ÐšÐ Ð˜Ð¢Ð˜Ð§Ð•Ð¡ÐšÐÐ¯ ÐžÐ¨Ð˜Ð‘ÐšÐ! Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð‘ÐžÐ•Ð’ÐÐ¯ Ð³Ñ€ÑƒÐ¿Ð¿Ð°!\n";
}
echo "\n";

echo "ðŸŽ‰ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾!\n";
echo "============================\n";
?>
