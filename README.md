# MeetRide Telegram Bot

> –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∑–∞—è–≤–æ–∫ –Ω–∞ —Ç–∞–∫—Å–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Bitrix24 CRM

[![Status](https://img.shields.io/badge/status-production-success)]()
[![PHP](https://img.shields.io/badge/PHP-7.4+-blue)]()
[![Python](https://img.shields.io/badge/Python-3.8+-blue)]()
[![Bitrix24](https://img.shields.io/badge/Bitrix24-REST%20API-orange)]()

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û –ø—Ä–æ–µ–∫—Ç–µ](#–æ-–ø—Ä–æ–µ–∫—Ç–µ)
- [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã](#–ª–æ–≥–∏–∫–∞-—Ä–∞–±–æ—Ç—ã)
- [–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã](#–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã-—Å–∏—Å—Ç–µ–º—ã)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)

---

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

**MeetRide Bot** ‚Äî —ç—Ç–æ Telegram-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞—è–≤–∫–∞–º–∏ –Ω–∞ —Ç–∞–∫—Å–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π Bitrix24 CRM. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å –æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –¥–æ –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–≤—è–∑—å –º–µ–∂–¥—É –¥–∏—Å–ø–µ—Ç—á–µ—Ä—Å–∫–æ–π –∏ –≤–æ–¥–∏—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Telegram.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:

- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫** –≤ –æ–±—â–∏–π —á–∞—Ç –≤–æ–¥–∏—Ç–µ–ª–µ–π
- ‚úÖ **–ü—Ä–∏–Ω—è—Ç–∏–µ –∑–∞—è–≤–æ–∫** –ª—é–±—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏ –Ω–æ–≤—ã–º–∏)
- ‚úÖ **–ü–æ–ª–Ω—ã–π workflow** (–ü—Ä–∏–Ω—è—Ç—å ‚Üí –ù–∞—á–∞—Ç—å ‚Üí –ó–∞–≤–µ—Ä—à–∏—Ç—å/–û—Ç–º–µ–Ω–∏—Ç—å)
- ‚úÖ **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö** –ø–æ–ª–µ–π –∑–∞—è–≤–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π** –∑–∞ —á–∞—Å –¥–æ –ø–æ–µ–∑–¥–∫–∏
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤** (–ø–∞—Å—Å–∞–∂–∏—Ä—ã —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—é)
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ç–æ—á–µ–∫ –º–∞—Ä—à—Ä—É—Ç–∞**
- ‚úÖ **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–ª–∞—Å—Å–æ–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π**

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏

–ë–æ—Ç –ø–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram –∏ —Å–æ–∑–¥–∞–µ—Ç —Å–¥–µ–ª–∫–∏ –≤ Bitrix24:

```
#Ô∏è‚É£ PT-1234
üöó –ö–æ–º—Ñ–æ—Ä—Ç
üìÜ 25 –¥–µ–∫–∞–±—Ä—è 2025 15:00
üÖ∞Ô∏è –ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å
üìç –¢–¶ –ê—Ñ–∏–º–æ–ª–ª
üÖ±Ô∏è –®–µ—Ä–µ–º–µ—Ç—å–µ–≤–æ, –¢–µ—Ä–º–∏–Ω–∞–ª D
‚úàÔ∏è SU 1234
üë• –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (+79001112233)
‚ÑπÔ∏è –° –¥–µ—Ç—Å–∫–∏–º –∫—Ä–µ—Å–ª–æ–º
üí∞ 5000/4000
```

### Workflow –∑–∞—è–≤–∫–∏

```mermaid
graph LR
    A[NEW] -->|–ú–µ–Ω–µ–¥–∂–µ—Ä| B[PREPARATION]
    B -->|Webhook| C[–û—Ç–ø—Ä–∞–≤–∫–∞ –≤ —á–∞—Ç]
    C -->|–í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª| D[PREPAYMENT_INVOICE]
    D -->|–ù–∞—á–∞–ª –ø–æ–µ–∑–¥–∫—É| E[EXECUTING]
    E -->|–ó–∞–≤–µ—Ä—à–∏–ª| F[FINAL_INVOICE]
    D -->|–û—Ç–º–µ–Ω–∏–ª| A
```

### Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**–î–≤–∞ –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ:**

1. **–ë–æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫** (`telegram_to_bitrix.py`)
   - –¢–æ–∫–µ–Ω: `7992462078:AAGJ46crBdOMSAuIfWncFd0AEjrDiT4Tnww`
   - –ü–∞—Ä—Å–∏—Ç –∑–∞—è–≤–∫–∏ –∏ —Å–æ–∑–¥–∞–µ—Ç —Å–¥–µ–ª–∫–∏ –≤ Bitrix24

2. **–ë–æ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** (`botManager.php`)
   - –¢–æ–∫–µ–Ω: `7529690360:AAHED5aKmuKjjfFQPRI-0RQ8DlxlZARA2O4`
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
meetride/
‚îú‚îÄ‚îÄ botManager.php                  # –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞ (Store\botManager)
‚îú‚îÄ‚îÄ telegram_to_bitrix.py          # –ë–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
‚îú‚îÄ‚îÄ reminder_scheduler_working.php # –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π (cron)
‚îú‚îÄ‚îÄ webhook_stage3.php             # Webhook –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.php                  # Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç Bitrix24
‚îÇ   ‚îî‚îÄ‚îÄ crest/                     # Bitrix24 REST API –∫–ª–∏–µ–Ω—Ç
‚îÇ
‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îî‚îÄ‚îÄ config.example.php         # –®–∞–±–ª–æ–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ setup_cron.sh             # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ ...                       # –î—Ä—É–≥–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ logs/                          # –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ webhook.log
‚îÇ   ‚îú‚îÄ‚îÄ cron.log
‚îÇ   ‚îî‚îÄ‚îÄ reminder_scheduler.log
‚îÇ
‚îî‚îÄ‚îÄ docs/                          # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îú‚îÄ‚îÄ SETUP.md                   # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    ‚îú‚îÄ‚îÄ TESTING.md                 # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
    ‚îî‚îÄ‚îÄ BITRIX24_INTEGRATION.md    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bitrix24
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

**Backend:**
- PHP 7.4+ (–æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- Python 3.8+ (–ø–∞—Ä—Å–∏–Ω–≥ –∑–∞—è–≤–æ–∫)
- Bitrix24 REST API
- Telegram Bot API

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
- `longman/telegram-bot` - PHP SDK –¥–ª—è Telegram
- `pyTelegramBotAPI` - Python SDK –¥–ª—è Telegram
- `CRest` - –∫–ª–∏–µ–Ω—Ç –¥–ª—è Bitrix24 API
- `Carbon` - —Ä–∞–±–æ—Ç–∞ —Å –¥–∞—Ç–∞–º–∏

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- Linux (Ubuntu/Debian)
- Apache/Nginx
- Cron (–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π)
- Git (–∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π)

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PHP 7.4+
- Python 3.8+
- Composer
- Git
- –î–æ—Å—Ç—É–ø –∫ Bitrix24

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/luxurygeorge-dev/meetride-bot.git
cd meetride-bot

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
composer install
pip3 install -r requirements.txt

# 3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp config/config.example.php config/config.php
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config.php —Å –≤–∞—à–∏–º–∏ —Ç–æ–∫–µ–Ω–∞–º–∏

# 4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å cron –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
./scripts/setup_cron.sh

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
python3 telegram_to_bitrix.py &
```

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** [docs/SETUP.md](docs/SETUP.md)

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏

```
Telegram –±–æ—Ç (telegram_to_bitrix.py)
   ‚Üì –ü–∞—Ä—Å–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
   ‚Üì POST ‚Üí Bitrix24 API
   ‚Üì –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–¥–µ–ª–∫–∞ –≤ —Å—Ç–∞–¥–∏–∏ NEW
   
Bitrix24
   ‚Üì –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ ‚Üí PREPARATION
   ‚Üì –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook ONCRMDEALUPDATE
   
Webhook (src/index.php)
   ‚Üì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: GROUP_MESSAGE_SENT_FIELD –ø—É—Å—Ç–æ–µ?
   ‚Üì –í—ã–∑—ã–≤–∞–µ—Ç botManager::newDealMessage()
   
Telegram (–æ–±—â–∏–π —á–∞—Ç)
   ‚úÖ –û–î–ù–û —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ [‚úÖ –ü—Ä–∏–Ω—è—Ç—å] [‚ùå –û—Ç–∫–∞–∑–∞—Ç—å—Å—è]
   ‚úÖ –ë–ï–ó –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ (–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ)
```

### 2Ô∏è‚É£ –í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞—è–≤–∫—É

```
–í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "‚úÖ –ü—Ä–∏–Ω—è—Ç—å"
   ‚Üì
botManager::driverAcceptHandle()
   ‚Üì –ù–∞–∑–Ω–∞—á–∞–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è –≤ CRM
   ‚Üì –ú–µ–Ω—è–µ—Ç —Å—Ç–∞–¥–∏—é ‚Üí PREPAYMENT_INVOICE
   ‚Üì –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç SERVICE-–ø–æ–ª—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
   ‚Üì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –æ–±—â–∏–π —á–∞—Ç
   ‚Üì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–µ—Ç–∞–ª–∏ –í –õ–ò–ß–ö–£ –≤–æ–¥–∏—Ç–µ–ª—é (—Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤)
   
–†–µ–∑—É–ª—å—Ç–∞—Ç:
   ‚úÖ –í–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –ª–∏—á–∫–µ
   ‚úÖ –í –æ–±—â–µ–º —á–∞—Ç–µ –≤–∏–¥–Ω–æ —á—Ç–æ –∑–∞—è–≤–∫—É –≤–∑—è–ª –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–¥–∏—Ç–µ–ª—å
   ‚ùå –ù–ï–¢ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
```

### 3Ô∏è‚É£ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

```
–ú–µ–Ω–µ–¥–∂–µ—Ä –∏–∑–º–µ–Ω—è–µ—Ç –ø–æ–ª–µ –≤ Bitrix24 (–∞–¥—Ä–µ—Å, –≤—Ä–µ–º—è, –∏ —Ç.–¥.)
   ‚Üì
Webhook ‚Üí src/index.php
   ‚Üì
botManager::dealChangeHandle()
   ‚Üì –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Å SERVICE-–ø–æ–ª–µ–º
   ‚Üì –ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—é
   
–í–æ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç:
   ‚ö†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–æ –ø–æ–ª–µ "–í—Ä–µ–º—è –ø–æ–¥–∞—á–∏"
   –ë—ã–ª–æ: 15:00
   –°—Ç–∞–ª–æ: 16:00
```

### 4Ô∏è‚É£ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π

```
Cron (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
   ‚Üì
reminder_scheduler_working.php
   ‚Üì –ü–æ–ª—É—á–∞–µ—Ç –∑–∞—è–≤–∫–∏ –≤ —Å—Ç–∞–¥–∏–∏ PREPAYMENT_INVOICE
   ‚Üì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –≤—Ä–µ–º—è –ø–æ–µ–∑–¥–∫–∏ - —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è = 1 —á–∞—Å?
   ‚Üì –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ?
   ‚Üì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤–æ–¥–∏—Ç–µ–ª—é
   
–í–æ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç:
   ‚è∞ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ: —á–µ—Ä–µ–∑ 1 —á–∞—Å –≤—ã–µ–∑–¥!
   #Ô∏è‚É£ PT-1234
   üìÜ –°–µ–≥–æ–¥–Ω—è –≤ 16:00
   üÖ∞Ô∏è –ê–¥—Ä–µ—Å –ø–æ–¥–∞—á–∏
```

---

## üß© –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### botManager.php

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–ª–∞—Å—Å —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π. –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:

```php
// –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏ –≤ —á–∞—Ç
botManager::newDealMessage($dealId, $telegram)

// –í–æ–¥–∏—Ç–µ–ª—å –ø—Ä–∏–Ω—è–ª –∑–∞—è–≤–∫—É
botManager::driverAcceptHandle($dealId, $driverId, $chatId, $messageId, $telegram)

// –í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª—Å—è
botManager::driverRejectHandle($dealId, $telegram, $chatId, $messageId)

// –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞—á–∞–ª –ø–æ–µ–∑–¥–∫—É
botManager::travelStartHandle($dealId, $driverId, $chatId, $messageId, $telegram)

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ–ª–µ–π
botManager::dealChangeHandle($dealId, $oldDeal, $newDeal, $telegram)

// –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
botManager::sendReminder($dealId, $telegram)
```

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø–æ–ª–µ–π Bitrix24

```php
// –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è
DRIVER_ID_FIELD = 'UF_CRM_1751272181'
ADDRESS_FROM_FIELD = 'UF_CRM_1751269147414'
ADDRESS_TO_FIELD = 'UF_CRM_1751269175432'
TRAVEL_DATE_TIME_FIELD = 'UF_CRM_1751269222959'

// SERVICE –ø–æ–ª—è (–¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)
ADDRESS_FROM_FIELD_SERVICE = 'UF_CRM_1751638512'
ADDRESS_TO_FIELD_SERVICE = 'UF_CRM_1751638529'
TRAVEL_DATE_TIME_FIELD_SERVICE = 'UF_CRM_1751638617'
```

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

**–ù–æ–º–µ—Ä–∞ –∑–∞—è–≤–æ–∫:**
- `PT-1234` (—Å –¥–µ—Ñ–∏—Å–æ–º)
- `PT1234` (–±–µ–∑ –¥–µ—Ñ–∏—Å–∞)
- `BTW999999`, `ABCD-5678` (2-4 –±—É–∫–≤—ã)

**–ö–ª–∞—Å—Å—ã –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π:**
- –≠–∫–æ–Ω–æ–º (ID: 97)
- –ö–æ–º—Ñ–æ—Ä—Ç (ID: 95)
- –ö–æ–º—Ñ–æ—Ä—Ç+ (ID: 103)
- –ë–∏–∑–Ω–µ—Å (ID: 105)
- –ú–∏–Ω–∏–≤—ç–Ω (ID: 99)
- –ú–∏–Ω–∏–≤—ç–Ω VIP (ID: 101)
- –°—Ç–∞–Ω–¥–∞—Ä—Ç (ID: 119)

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **[docs/SETUP.md](docs/SETUP.md)** - –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- **[docs/TESTING.md](docs/TESTING.md)** - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã
- **[docs/BITRIX24_INTEGRATION.md](docs/BITRIX24_INTEGRATION.md)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±—Ö—É–∫–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Bitrix24
- **[CHANGELOG.md](CHANGELOG.md)** - –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏

```bash
# Webhook —Å–æ–±—ã—Ç–∏—è
tail -f /var/www/html/meetRiedeBot/logs/webhook_debug.log

# –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
tail -f /root/meetride/logs/reminder_scheduler.log

# Cron –∑–∞–¥–∞—á–∏
tail -f /root/meetride/logs/cron.log
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ë–æ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–æ–∫
ps aux | grep telegram_to_bitrix

# Webhook endpoint
curl https://skysoft24.ru/meetRiedeBot/index.php

# Cron –∑–∞–¥–∞—á–∏
crontab -l
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- ü§ñ **–ë–æ—Ç—ã:** 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö
- üì® **Webhook:** https://skysoft24.ru/meetRiedeBot/index.php
- ‚è∞ **Cron:** –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- üìÇ **–ü—Ä–æ–¥–∞–∫—à–Ω:**
  - Bot: `/opt/meetride/telegram_to_bitrix.py`
  - Webhook: `/var/www/html/meetRiedeBot/`
- üõ†Ô∏è **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** `/root/meetride/`

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `.gitignore` (—Ç–æ–∫–µ–Ω—ã, webhook URLs)
- ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤ —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è–º
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ Handler ID –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–µ–π—Å—Ç–≤–∏—è–º

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ó–∞—è–≤–∫–∞ –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —á–∞—Ç

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ webhook
tail -50 /var/www/html/meetRiedeBot/logs/webhook_debug.log

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–¥–∏—é —Å–¥–µ–ª–∫–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å PREPARATION)
cd /root/meetride
php simple_test.php <DEAL_ID>

# 3. –†—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
php send_deal.php <DEAL_ID>
```

### –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron
crontab -l

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
tail -50 /root/meetride/logs/reminder_scheduler.log

# 3. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
cd /root/meetride
php reminder_scheduler_working.php
```

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ webhook'–æ–≤ –≤ Bitrix24 —Å —Å–æ–±—ã—Ç–∏–µ–º ONCRMDEALUPDATE
- –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å Handler ID = 3
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ GROUP_MESSAGE_SENT_FIELD –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

**–ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:**
- `/root/meetride/botManager.php` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `/root/meetride/src/index.php` - webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
- `/root/meetride/telegram_to_bitrix.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- `simple_test.php` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Bitrix24
- `send_deal.php` - —Ä—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ –≤ —á–∞—Ç
- `check_deal_671.php` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞—è–≤–∫–∏

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è MeetRide. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 4 –Ω–æ—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready
