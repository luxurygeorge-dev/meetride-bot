# ‚úÖ –£–°–ü–ï–®–ù–û–ï –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï MEETRIDE BOT

**–î–∞—Ç–∞:** 5 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** üöÄ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢**

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢:

1. **Bitrix24 ‚Üí Telegram (–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–æ–∫)**
   - ‚úÖ Webhook –æ—Ç Bitrix24 –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
   - ‚úÖ –ü—Ä–∏ —Å–º–µ–Ω–µ —Å—Ç–∞–¥–∏–∏ –Ω–∞ PREPARATION –∑–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø—É
   - ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏
   - ‚úÖ –ö–Ω–æ–ø–∫–∏ [–ü—Ä–∏–Ω—è—Ç—å] [–û—Ç–∫–∞–∑–∞—Ç—å—Å—è] –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

2. **Telegram ‚Üí Bitrix24 (–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –≤–æ–¥–∏—Ç–µ–ª—è)**
   - ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–∏–Ω—è—Ç—å" —Ä–∞–±–æ—Ç–∞–µ—Ç
   - ‚úÖ –°—Ç–∞–¥–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è: PREPARATION ‚Üí PREPAYMENT_INVOICE
   - ‚úÖ –ö–Ω–æ–ø–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è
   - ‚úÖ –í –≥—Ä—É–ø–ø—É –ø—Ä–∏—Ö–æ–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ó–∞—è–≤–∫—É –≤–∑—è–ª –≤–æ–¥–∏—Ç–µ–ª—å [–ò–º—è]"
   - ‚úÖ –í–æ–¥–∏—Ç–µ–ª—é –≤ –õ–° –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏ (2 —Å–æ–æ–±—â–µ–Ω–∏—è)

3. **–°–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   - ‚úÖ SERVICE –ø–æ–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ –∑–∞—è–≤–∫–∏
   - ‚úÖ –ì–æ—Ç–æ–≤–∞ –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ–ª–µ–π

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ #1: Fatal Error - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª–∞—Å—Å–∞
**–ü—Ä–∏—á–∏–Ω–∞:** 3 –∫–æ–ø–∏–∏ `botManager.php` –≤ —Ä–∞–∑–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–¥–∞–ª–µ–Ω—ã –¥—É–±–ª–∏–∫–∞—Ç—ã –∏–∑ `src/` –∏ `Store/`
- –û—Å—Ç–∞–≤–ª–µ–Ω –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ—Ä–Ω–µ–≤–æ–π —Ñ–∞–π–ª
- –†–µ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω composer autoload

### –ü—Ä–æ–±–ª–µ–º–∞ #2: Telegram Bot SDK –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
**–ü—Ä–∏—á–∏–Ω–∞:** –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –ø–∞–∫–µ—Ç `irazasyed/telegram-bot-sdk`
**–†–µ—à–µ–Ω–∏–µ:** 
```bash
composer require irazasyed/telegram-bot-sdk
```

### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∑–∞–≥—Ä—É–∑–∫–∏ CRest
**–ü—Ä–∏—á–∏–Ω–∞:** –î–≤–æ–π–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∫–ª–∞—Å—Å–∞ CRest –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –µ–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ `/home/telegramBot/crest/crest.php`

### –ü—Ä–æ–±–ª–µ–º–∞ #4: Telegram webhook —É–∫–∞–∑—ã–≤–∞–ª –Ω–∞ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª
**–ü—Ä–∏—á–∏–Ω–∞:** Webhook –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `index.php` (404 –æ—à–∏–±–∫–∞)
**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `webhook.php`

### –ü—Ä–æ–±–ª–µ–º–∞ #5: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∫ crest.php –≤ botManager
**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ `__DIR__ . '/crest/crest.php'`
**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ `/home/telegramBot/crest/crest.php`

### –ü—Ä–æ–±–ª–µ–º–∞ #6: –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API –≤ buttonHanlde
**–ü—Ä–∏—á–∏–Ω–∞:** –°–º–µ—à–∏–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ `$result->get()` –∏ `$result->callbackQuery`
**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–∞ –æ–±—ä–µ–∫—Ç–Ω—ã–π API

---

## üìä –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ):

```
1. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤ Bitrix24
   ‚Üì –ú–µ–Ω—è–µ—Ç —Å—Ç–∞–¥–∏—é –Ω–∞ PREPARATION
   
2. Bitrix24 Webhook
   ‚Üì ONCRMDEALUPDATE ‚Üí skysoft24.ru/meetRiedeBot/src/index.php
   ‚Üì Event handler ID: 3
   ‚Üì Token: ancn7qxhagfsifwxkcoo7s04tfc8q2ez ‚úÖ
   
3. –°–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram –≥—Ä—É–ø–ø—É
   ‚úÖ –¢–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
   ‚úÖ –ö–Ω–æ–ø–∫–∏ [–ü—Ä–∏–Ω—è—Ç—å] [–û—Ç–∫–∞–∑–∞—Ç—å—Å—è]
   
4. –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç [–ü—Ä–∏–Ω—è—Ç—å]
   ‚Üì Callback Query ‚Üí webhook.php
   
5. –û–±—Ä–∞–±–æ—Ç–∫–∞ callback
   ‚úÖ buttonHanlde() ‚Üí driverAcceptHandle()
   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–æ–¥–∏—Ç–µ–ª—è –≤ CRM
   ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
   ‚úÖ –°–º–µ–Ω–∞ —Å—Ç–∞–¥–∏–∏ ‚Üí PREPAYMENT_INVOICE
   ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è SERVICE –ø–æ–ª–µ–π
   
6. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   ‚úÖ –í –≥—Ä—É–ø–ø—É: "–ó–∞—è–≤–∫—É –≤–∑—è–ª –≤–æ–¥–∏—Ç–µ–ª—å [–ò–º—è]"
   ‚úÖ –í –õ–° –≤–æ–¥–∏—Ç–µ–ª—é: –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (2 —Å–æ–æ–±—â–µ–Ω–∏—è)
   ‚úÖ –ö–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω—ã –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è)

```
/var/www/html/meetRiedeBot/
‚îú‚îÄ‚îÄ botManager.php              ‚Üê –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
‚îú‚îÄ‚îÄ webhook.php                 ‚Üê Telegram callback endpoint
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ index.php              ‚Üê Bitrix24 webhook endpoint
‚îÇ   ‚îî‚îÄ‚îÄ crest/                 ‚Üê CRest SDK
‚îú‚îÄ‚îÄ vendor/                     ‚Üê Composer packages
‚îÇ   ‚îú‚îÄ‚îÄ irazasyed/telegram-bot-sdk/  ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ logs/
    ‚îî‚îÄ‚îÄ webhook_debug.log       ‚Üê –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

/home/telegramBot/crest/
‚îî‚îÄ‚îÄ crest.php                   ‚Üê Bitrix24 API (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫)

/root/meetride/
‚îî‚îÄ‚îÄ botManager.php              ‚Üê Dev –∫–æ–ø–∏—è (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é)
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Bitrix24 Webhook:
- **URL:** `https://skysoft24.ru/meetRiedeBot/src/index.php`
- **–°–æ–±—ã—Ç–∏–µ:** ONCRMDEALUPDATE
- **Handler ID:** 3
- **Token:** `ancn7qxhagfsifwxkcoo7s04tfc8q2ez`

### Telegram Webhook:
- **URL:** `https://skysoft24.ru/meetRiedeBot/webhook.php`
- **Bot Token:** `7529690360:AAHED5aKmuKjjfFQPRI-0RQ8DlxlZARA2O4`
- **Updates:** message, callback_query

### Telegram –≥—Ä—É–ø–ø–∞:
- **ID:** `-1001649190984`
- **–ù–∞–∑–≤–∞–Ω–∏–µ:** "SkySoft –∑–∞—è–≤–∫–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤"

---

## üß™ –¢–µ—Å—Ç—ã (–≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ)

1. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏ #787 –≤ –≥—Ä—É–ø–ø—É
2. ‚úÖ –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∏–Ω—è—Ç—å"
3. ‚úÖ –°–º–µ–Ω–∞ —Å—Ç–∞–¥–∏–∏ –≤ Bitrix24
4. ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –≥—Ä—É–ø–ø—É –∏ –õ–°
5. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

1. **–ù–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã** `botManager.php`
2. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö** –≤ dev ‚Üí prod: 
   ```bash
   cp /root/meetride/botManager.php /var/www/html/meetRiedeBot/botManager.php
   ```
3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:**
   ```bash
   tail -f /var/www/html/meetRiedeBot/logs/webhook_debug.log
   ```
4. **–ë—ç–∫–∞–ø—ã** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏:
   ```bash
   cp -r /var/www/html/meetRiedeBot /root/meetride_backup_$(date +%Y%m%d)
   ```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `/var/www/html/meetRiedeBot/BITRIX24_WEBHOOK_SETUP.md` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bitrix24
- `/root/meetride/–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_20251005.md` - –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- `/var/www/html/meetRiedeBot/WORKFLOW.md` - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç—ã

---

**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞! üéâ**
